<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login & Register</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #6a11cb;
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    margin: 0; padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .container {
    background: white;
    padding: 25px 30px;
    border-radius: 10px;
    width: 320px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }

  h2 {
    text-align: center;
    color: #333;
  }

  form {
    display: flex;
    flex-direction: column;
    margin-top: 15px;
  }

  input, select, button {
    margin: 8px 0;
    padding: 10px;
    font-size: 16px;
    border-radius: 6px;
    border: 1.5px solid #ccc;
  }

  input:focus, select:focus {
    border-color: #6a11cb;
    outline: none;
  }

  button {
    background: #6a11cb;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: bold;
  }

  button:hover {
    background: #2575fc;
  }

  #message {
    margin: 10px 0;
    font-weight: bold;
    text-align: center;
    color: red;
  }

  #toggle-text {
    text-align: center;
    margin-top: 12px;
    font-size: 14px;
    color: #555;
  }

  #toggle-link {
    color: #6a11cb;
    cursor: pointer;
    font-weight: bold;
  }

  #upload-section {
    display: none;
    margin-top: 15px;
  }

  ul {
    list-style: none;
    padding-left: 0;
  }

  li {
    background: #f1f1f1;
    padding: 6px 10px;
    margin: 4px 0;
    border-radius: 5px;
  }

  #logout-btn {
    margin-top: 15px;
    background: #e74c3c;
  }

  #logout-btn:hover {
    background: #c0392b;
  }

</style>
</head>
<body>

<div class="container">

  <h2 id="form-title">Login</h2>
  <div id="message"></div>

  <form id="auth-form">
    <input type="text" id="username" placeholder="Username" required autocomplete="username" />
    <input type="password" id="password" placeholder="Password" required autocomplete="current-password" />
    <select id="role-select" style="display:none;" aria-label="Select role">
      <option value="User">User</option>
      <option value="Admin">Admin</option>
    </select>
    <button type="submit" id="submit-btn">Login</button>
  </form>

  <p id="toggle-text">
    Don't have an account? <span id="toggle-link">Register here</span>
  </p>

  <div id="upload-section">
    <h3>Upload PDF File</h3>
    <form id="upload-form">
      <input type="file" id="file-input" accept="application/pdf" required />
      <button type="submit">Upload</button>
    </form>

    <h3>Your Files</h3>
    <ul id="file-list"></ul>

    <button id="logout-btn">Logout</button>
  </div>

</div>

<script>
  const formTitle = document.getElementById('form-title');
  const messageDiv = document.getElementById('message');
  const authForm = document.getElementById('auth-form');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const submitBtn = document.getElementById('submit-btn');
  const toggleLink = document.getElementById('toggle-link');
  const toggleText = document.getElementById('toggle-text');
  const uploadSection = document.getElementById('upload-section');
  const uploadForm = document.getElementById('upload-form');
  const fileInput = document.getElementById('file-input');
  const logoutBtn = document.getElementById('logout-btn');
  const fileList = document.getElementById('file-list');
  const roleSelect = document.getElementById('role-select');

  let isLogin = true;

  const users = {};
  let currentUser = null;
  const userFiles = {};

  function showMessage(msg, isError = true) {
    messageDiv.textContent = msg;
    messageDiv.style.color = isError ? 'red' : 'green';
  }

  toggleLink.onclick = () => {
    isLogin = !isLogin;
    if (isLogin) {
      formTitle.textContent = 'Login';
      submitBtn.textContent = 'Login';
      toggleText.innerHTML = "Don't have an account? <span id='toggle-link'>Register here</span>";
      roleSelect.style.display = 'none';
      passwordInput.setAttribute('autocomplete', 'current-password');
    } else {
      formTitle.textContent = 'Register';
      submitBtn.textContent = 'Register';
      toggleText.innerHTML = "Already have an account? <span id='toggle-link'>Login here</span>";
      roleSelect.style.display = 'block';
      passwordInput.setAttribute('autocomplete', 'new-password');
    }
    messageDiv.textContent = '';
    authForm.reset();
    // Rebind toggle link event after innerHTML change
    document.getElementById('toggle-link').onclick = toggleLink.onclick;
  };

  authForm.onsubmit = e => {
    e.preventDefault();
    showMessage('');

    const username = usernameInput.value.trim();
    const password = passwordInput.value;
    const role = roleSelect.value;

    if (!username || !password) {
      showMessage('Please fill username and password.');
      return;
    }

    if (!isLogin) {
      if (users[username]) {
        showMessage('Username already exists.');
        return;
      }
      // Password strength: 8 chars minimum with uppercase, lowercase, special char
      const passRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{8,}$/;
      if (!passRegex.test(password)) {
        showMessage('Password must have uppercase, lowercase, special char, min 8 chars.');
        return;
      }
      users[username] = { password, role };
      userFiles[username] = [];
      showMessage('Registered successfully! You can login now.', false);
      toggleLink.click();
    } else {
      if (users[username] && users[username].password === password) {
        currentUser = username;
        showUploadSection();
        showMessage('');
      } else {
        showMessage('Invalid username or password.');
      }
    }
    passwordInput.value = '';
  };

  function showUploadSection() {
    authForm.style.display = 'none';
    toggleText.style.display = 'none';
    formTitle.style.display = 'none';
    uploadSection.style.display = 'block';
    updateFileList();
  }

  uploadForm.onsubmit = e => {
    e.preventDefault();
    if (!fileInput.files.length) {
      alert('Please select a PDF file.');
      return;
    }
    const file = fileInput.files[0];
    if (!file.name.toLowerCase().endsWith('.pdf')) {
      alert('Only PDF files allowed.');
      return;
    }
    userFiles[currentUser].push(file.name);
    fileInput.value = '';
    updateFileList();
  };

  function updateFileList() {
    fileList.innerHTML = '';
    const role = users[currentUser].role;
    if (role === 'Admin') {
      // Show all users files
      for (const user in userFiles) {
        if (userFiles[user].length === 0) continue;
        const userTitle = document.createElement('li');
        userTitle.style.fontWeight = 'bold';
        userTitle.textContent = user + ':';
        fileList.appendChild(userTitle);
        userFiles[user].forEach(fileName => {
          const li = document.createElement('li');
          li.textContent = fileName;
          fileList.appendChild(li);
        });
      }
    } else {
      // Show current user's files only
      if (userFiles[currentUser].length === 0) {
        const li = document.createElement('li');
        li.textContent = 'No files uploaded yet.';
        fileList.appendChild(li);
      } else {
        userFiles[currentUser].forEach(fileName => {
          const li = document.createElement('li');
          li.textContent = fileName;
          fileList.appendChild(li);
        });
      }
    }
  }

  logoutBtn.onclick = () => {
    currentUser = null;
    uploadSection.style.display = 'none';
    authForm.style.display = 'flex';
    toggleText.style.display = 'block';
    formTitle.style.display = 'block';
    formTitle.textContent = 'Login';
    toggleText.innerHTML = "Don't have an account? <span id='toggle-link'>Register here</span>";
    roleSelect.style.display = 'none';
    showMessage('Logged out successfully.', false);
    authForm.reset();
    document.getElementById('toggle-link').onclick = toggleLink.onclick;
  };
</script>

</body>
</html>
